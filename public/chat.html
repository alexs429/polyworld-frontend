<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Travel Chat Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    #chat { max-width: 600px; margin: auto; background: #fff; border: 1px solid #ddd; border-radius: 6px; padding: 20px; }
    #messages { height: 400px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #fafafa; }
    .msg { margin: 8px 0; }
    .user { font-weight: bold; color: #0066cc; }
    .bot { font-weight: bold; color: #009933; }
    #inputBox { display: flex; margin-top: 10px; }
    #message { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    button { margin-left: 10px; padding: 10px 20px; border: none; background: #0066cc; color: #fff; border-radius: 4px; cursor: pointer; }
    button:hover { background: #0052a3; }
  </style>
</head>
<body>
  <div id="chat">
    <h2>üåç Travel Consultant Demo</h2>
    <div id="messages"></div>
    <div id="inputBox">
      <input type="text" id="message" placeholder="Type your question..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    const API_URL = "https://us-central1-polyworld-2f581.cloudfunctions.net/dialogFlowDemo";
    const userId = "demo-user"; // could also be randomized per session

    async function sendMessage(text) {
      if (text) addMessage("user", text);

      try {
        const url = `${API_URL}?userId=${userId}&message=${encodeURIComponent(text || "hello")}`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.reply) {
          addMessage("bot", data.reply);
        } else {
          addMessage("bot", "‚ö†Ô∏è No response from agent");
        }
      } catch (err) {
        console.error(err);
        addMessage("bot", "‚ùå Error contacting agent");
      }
    }

    function addMessage(sender, text) {
      const msgDiv = document.createElement("div");
      msgDiv.classList.add("msg");
      msgDiv.innerHTML = `<span class="${sender}">${sender === "user" ? "You" : "Bot"}:</span> ${text}`;
      document.getElementById("messages").appendChild(msgDiv);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    }

    // Enter key to send
    document.getElementById("message").addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage(document.getElementById("message").value.trim());
    });

    // Auto-intro on load
    window.onload = () => {
      addMessage("bot", "‚è≥ Connecting to your travel consultant...");
      sendMessage(""); // triggers agent intro
    };
  </script>
</body>
</html>
